(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admin-upload-knowledge"],{"0bac":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{type:"flex"}},[a("upload",{attrs:{isShow:!1,tip:"仅支持上传md格式文件"},on:{upload:e.upload}},[a("el-form-item",{attrs:{slot:"section",label:"所属章节"},slot:"section"},[a("el-tree",{ref:"tree",attrs:{accordion:"",data:e.treeData,"show-checkbox":"",props:e.defaultProps}})],1),a("el-button",{staticStyle:{"font-size":"17px","margin-left":"10px"},attrs:{slot:"add",type:"primary",size:"small"},on:{click:e.showDialog},slot:"add"},[e._v("+")])],1),a("knowledge-table",{attrs:{courses:e.courses,tableData:e.tableData}}),a("add-course-dialog",{attrs:{isVisible:e.isDialogVisible},on:{cancel:e.hideDialog,submit:e.createCourse}})],1)},o=[],r=(a("456d"),a("768b")),l=(a("ac4d"),a("8a81"),a("ac6a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"",height:"550"}},[a("el-table-column",{attrs:{label:"已上传知识见解",align:"center"}},[a("el-table-column",{attrs:{prop:"course",label:"课程",align:"center",width:"250",filters:e.courses,"filter-method":e.filterHandler}}),a("el-table-column",{attrs:{prop:"chapter",label:"已上传章",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("第"+e._s(t.row.chapter)+"章")])]}}])}),a("el-table-column",{attrs:{prop:"section",label:"已上传节",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.sections,function(t){return a("el-tag",{key:t,staticStyle:{margin:"5px 5px"},attrs:{"disable-transitions":""}},[a("span",0==t?[e._v("概述")]:[e._v(e._s(t))])])})}}])})],1)],1)}),i=[],n={props:{tableData:Array,courses:Array},data:function(){return{}},methods:{filterHandler:function(e,t,a){var s=a["property"];return t[s]===e}}},c=n,u=a("2877"),d=Object(u["a"])(c,l,i,!1,null,null,null),f=d.exports,p=a("d443"),h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"添加课程",visible:e.isVisible},on:{close:e.cancel}},[a("el-form",{attrs:{model:e.course}},[a("el-form-item",{attrs:{label:"课程名","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"课程名称"},model:{value:e.course.title,callback:function(t){e.$set(e.course,"title",t)},expression:"course.title"}})],1),a("el-form-item",{attrs:{label:"描述","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"课程描述"},model:{value:e.course.describe,callback:function(t){e.$set(e.course,"describe",t)},expression:"course.describe"}})],1),a("el-form-item",{attrs:{label:"初始版本号","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"如 V1.0，V2.1"},model:{value:e.course.vid,callback:function(t){e.$set(e.course,"vid",t)},expression:"course.vid"}})],1),a("el-form-item",{attrs:{label:"封面URL","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"50%"},attrs:{autocomplete:"off",placeholder:"不填则默认封面"},model:{value:e.course.iconPath,callback:function(t){e.$set(e.course,"iconPath",t)},expression:"course.iconPath"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},b=[],g={props:{isVisible:Boolean},data:function(){return{course:{title:"",describe:"",vid:"",iconPath:""},formLabelWidth:"120px"}},methods:{cancel:function(){this.$emit("cancel")},submit:function(){this.$emit("submit",this.course)}}},m=g,v=Object(u["a"])(m,h,b,!1,null,null,null),w=v.exports,y=a("83af"),$={name:"UploadKnowledge",inject:["reload"],components:{KnowledgeTable:f,Upload:p["a"],AddCourseDialog:w},data:function(){return{tableData:[],courses:[],defaultProps:{children:"children",label:"label"},isDialogVisible:!1}},computed:{treeData:function(){for(var e=[],t=[],a=0;a<15;a++){t=[];for(var s=0;s<15;s++)t.push({label:"第"+(s+1)+"节",value:[a+1,s+1]});e.push({label:"第"+(a+1)+"章",value:a+1,children:t})}return[{label:"全选",children:e}]}},created:function(){this.getTableData()},methods:{upload:function(e){var t=this;if(!t.$refs.tree.getCheckedNodes()[0]||e.course<0||!e.fileList[0].raw)this.$message.warning("请将信息填写完整");else{console.log(JSON.stringify(t.getSeqs(t.$refs.tree.getCheckedNodes())));var a=new FormData;a.append("cid",e.course),a.append("file",e.fileList[0].raw),a.append("seqs",JSON.stringify(t.getSeqs(t.$refs.tree.getCheckedNodes())));var s=!0,o=!1,l=void 0;try{for(var i,n=a.entries()[Symbol.iterator]();!(s=(i=n.next()).done);s=!0){var c=Object(r["a"])(i.value,2),u=c[0],d=c[1];console.log(u,d)}}catch(f){o=!0,l=f}finally{try{s||null==n.return||n.return()}finally{if(o)throw l}}Object(y["c"])().post("/backstage/course/save ",a).then(function(e){console.log(e),200===e.data.code?t.$message({message:"上传成功",type:"success"}):t.$message({message:"请上传格式正确的文件",type:"warning"})}).catch(function(e){console.log(JSON.stringify(e)),t.$message({message:"请上传格式正确的文件",type:"warning"})})}},getSeqs:function(e){var t=[];e.forEach(function(e){e.children||t.push(e.value)});var a=-1,s=t.reduce(function(e,t){if(t[0]===parseInt(Object.keys(e)[a]))e[t[0]].push(t[1]);else{a++;var s=[];s.push(t[1]),e[t[0]]=s}return e},{});for(var o in t=[],s)15==s[o].length?t.push({chapter:parseInt(o),sections:[]}):t.push({chapter:parseInt(o),sections:s[o]});return t},showDialog:function(){this.isDialogVisible=!0},hideDialog:function(){this.isDialogVisible=!1},createCourse:function(e){var t=this;console.log(e),e.iconPath||(e.iconPath="img/logo.jpg"),e.describe&&e.title&&e.vid?this.$http.post("/backstage/course/create",e).then(function(e){console.log(e.data),200===e.data.code?(t.$message({message:"创建课程成功",type:"success"}),t.isDialogVisible=!1,setTimeout(function(){t.reload()},1500)):t.$message({showClose:!0,message:e.data.message,type:"error"})}).catch(function(e){console.log(e)}):this.$message({message:"请将信息填写完整",type:"warning"})},getTableData:function(){var e=this;this.$http.get("/course/getAllCourse").then(function(t){if(200===t.data.code){var a=[];return t.data.data.courses.forEach(function(e){a.push({text:e.courseName,value:e.courseName})}),e.courses=a,t.data.data.courses}e.$message({showClose:!0,message:t.data.message,type:"error"})}).then(function(t){e.getCourseProgress(t)}).catch(function(e){console.log(e)})},getCourseProgress:function(e){var t=this;e.map(function(e){t.$http.post("/backstage/course/progress",{cid:e.cid,vid:e.vid}).then(function(a){200===a.data.code?a.data.data.progress.forEach(function(a){t.tableData.push({course:e.courseName,chapter:a.chapter,sections:a.sections})}):t.$message({showClose:!0,message:a.data.message,type:"error"})}).catch(function(e){console.log(e)})})}}},k=$,D=(a("8c76"),Object(u["a"])(k,s,o,!1,null,null,null));t["default"]=D.exports},"456d":function(e,t,a){var s=a("4bf8"),o=a("0d58");a("5eda")("keys",function(){return function(e){return o(s(e))}})},"4b02":function(e,t,a){},"5eda":function(e,t,a){var s=a("5ca1"),o=a("8378"),r=a("79e5");e.exports=function(e,t){var a=(o.Object||{})[e]||Object[e],l={};l[e]=t(a),s(s.S+s.F*r(function(){a(1)}),"Object",l)}},"8c76":function(e,t,a){"use strict";var s=a("4b02"),o=a.n(s);o.a}}]);
//# sourceMappingURL=admin-upload-knowledge.48278500.js.map