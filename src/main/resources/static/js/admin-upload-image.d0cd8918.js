(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admin-upload-image"],{d5c6:function(e,t,a){"use strict";var l=a("f766"),n=a.n(l);n.a},f766:function(e,t,a){},fc31:function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{type:"flex"}},[a("upload",{attrs:{options:e.options,url:e.url,tip:"限上传png/jpg/gif等格式文件"},on:{upload:e.upload,clearUrl:e.clearUrl}},[a("el-form-item",{attrs:{slot:"url",label:"URL"},slot:"url"},[e.url?a("span",{staticClass:"url"},[e._v(e._s(e.url))]):e._e()])],1),a("img-table",{attrs:{courses:e.courses,chapters:e.chapters,sections:e.sections,tableData:e.tableData,loading:e.loading},on:{loadData:e.getTableData}})],1)},n=[],r=a("768b"),s=(a("ac4d"),a("8a81"),a("ac6a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"filterTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:"","max-height":"550","element-loading-text":"加载中","element-loading-spinner":"el-icon-loading"}},[a("el-table-column",{attrs:{label:"上传记录",align:"center"}},[a("el-table-column",{attrs:{prop:"name",label:"文件名",align:"center"}}),a("el-table-column",{attrs:{prop:"course",label:"所属课程",align:"center",filters:e.courses,"filter-method":e.filterHandler}}),a("el-table-column",{attrs:{prop:"chapter",label:"所属章",align:"center",filters:e.chapters,"filter-method":e.filterHandler}}),a("el-table-column",{attrs:{prop:"section",label:"所属节",align:"center",filters:e.sections,"filter-method":e.filterHandler}})],1),a("el-table-column",{attrs:{label:"上传记录",align:"center"}},[a("template",{slot:"header"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.reload}},[e._v("刷新")])],1),a("el-table-column",{attrs:{prop:"url",label:"URL",align:"center"}}),a("el-table-column",{attrs:{label:"预览(点击预览大图)",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{attrs:{src:t.row.url,"preview-src-list":e.srcList},on:{click:function(a){return e.preview(t.row.url)}}})]}}])})],2)],1)}),o=[],i={props:{courses:Array,chapters:Array,sections:Array,tableData:Array,loading:Boolean},data:function(){return{srcList:[]}},methods:{filterHandler:function(e,t,a){var l=a["property"];return t[l]===e},reload:function(){this.$emit("loadData")},preview:function(e){this.srcList=[e]}}},c=i,u=a("2877"),p=Object(u["a"])(c,s,o,!1,null,null,null),d=p.exports,f=a("d443"),g=a("83af"),h={name:"UploadImg",components:{ImgTable:d,Upload:f["a"]},data:function(){return{courses:[],chapters:[],sections:[],tableData:[],url:null,loading:!1}},created:function(){this.getCourses(),this.getTableData()},computed:{options:function(){return this.getOptions()}},methods:{upload:function(e){var t=this,a=this;if(e.section&&e.fileList[0]&&-1!==e.course){var l=new FormData;l.append("file",e.fileList[0].raw),l.append("cid",e.course),l.append("sections",e.section);var n=!0,s=!1,o=void 0;try{for(var i,c=l.entries()[Symbol.iterator]();!(n=(i=c.next()).done);n=!0){var u=Object(r["a"])(i.value,2),p=u[0],d=u[1];console.log(p,d)}}catch(h){s=!0,o=h}finally{try{n||null==c.return||c.return()}finally{if(s)throw o}}var f=a.$loading({lock:!0,text:"上传中",spinner:"el-icon-loading"});Object(g["c"])().post("/picture/upload",l).then(function(e){console.log(e),200===e.data.code?t.url=e.data.data.url:a.$message({message:e.data.message,type:"warning"}),f.close()}).catch(function(e){f.close(),console.log(JSON.stringify(e)),a.$message({message:"请上传格式正确的文件",type:"warning"})})}else a.$message.warning("请将信息填写完整")},getOptions:function(){var e=["一","二","三","四","五","六","七","八","九","十","十一","十二","十三","十四","十五"],t=[],a=[];e.forEach(function(e){var l={value:"第"+e+"章",label:"第"+e+"章",text:"第"+e+"章"},n={value:"第"+e+"节",label:"第"+e+"节",text:"第"+e+"节"};t.push(l),a.push(n)});var l=[];return t.forEach(function(e,t){l.push({value:e.value,label:e.label,children:a})}),this.chapters=t,this.sections=a,l},getCourses:function(){var e=this;e.$http.get("/course/getAllCourse").then(function(t){if(200===t.data.code){var a=[];t.data.data.courses.forEach(function(e){a.push({text:e.courseName,value:e.courseName})}),e.courses=a}else this.$message({showClose:!0,message:t.data.message,type:"error"})}).catch(function(e){console.log(e)})},getTableData:function(){var e=this;e.loading=!0,e.$http.get("/picture/list").then(function(t){if(200===t.data.code){var a=[];t.data.data.pictures.forEach(function(e){a.push({name:e.orgName,course:e.course,chapter:e.sectionList?e.sectionList[0]:null,section:e.sectionList?e.sectionList[1]:null,url:e.url})}),e.tableData=a,e.loading=!1}else e.loading=!1,this.$message({showClose:!0,message:t.data.message,type:"error"})}).catch(function(t){e.loading=!1,console.log(t)})},clearUrl:function(){this.url=null}}},m=h,b=(a("d5c6"),Object(u["a"])(m,l,n,!1,null,null,null));t["default"]=b.exports}}]);
//# sourceMappingURL=admin-upload-image.d0cd8918.js.map